(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-tool-cropper"],{"0980":function(e,t,o){"use strict";var n=o("3cf1"),r=o.n(n);r.a},"3cf1":function(e,t,o){var n=o("8f1d");"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var r=o("4f06").default;r("45fb2d99",n,!0,{sourceMap:!1,shadowMode:!1})},8991:function(e,t,o){"use strict";o.r(t);var n=o("b120"),r=o("bfd7");for(var i in r)"default"!==i&&function(e){o.d(t,e,function(){return r[e]})}(i);o("0980");var a=o("2877"),c=Object(a["a"])(r["default"],n["a"],n["b"],!1,null,"31e57b3c",null);t["default"]=c.exports},"8f1d":function(e,t,o){t=e.exports=o("2350")(!1),t.push([e.i,"uni-page-body[data-v-31e57b3c]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:100%;height:100%;background-color:#f8f8f8;font-family:Arial,Helvetica,sans-serif;overflow-x:hidden}.flex[data-v-31e57b3c]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center}.cropper-wrapper[data-v-31e57b3c]{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:100%;background-color:#e5e5e5}.cropper-buttons[data-v-31e57b3c],.cropper-buttons-tip[data-v-31e57b3c]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;position:fixed;bottom:0;left:0;width:100%;height:%?100?%;line-height:%?100?%;text-align:center;font-size:%?24?%}.cropper-buttons-tip[data-v-31e57b3c]{bottom:50px;color:grey}.cropper-buttons .getCropperImage[data-v-31e57b3c],.cropper-buttons .upload[data-v-31e57b3c]{-webkit-box-flex:1;-webkit-flex:1;-ms-flex:1;flex:1;text-align:center;font-size:%?32?%}.cropper[data-v-31e57b3c]{position:absolute;top:0;left:0}.cropper-buttons[data-v-31e57b3c]{background-color:#666;color:#fff}body.?%PAGE?%[data-v-31e57b3c]{background-color:#f8f8f8}",""])},b120:function(e,t,o){"use strict";var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("v-uni-view",[o("v-uni-view",{staticClass:"cropper-wrapper"},[o("v-uni-canvas",{staticClass:"cropper",style:{width:e.cropperOpt.width+"px",height:e.cropperOpt.height+"px","background-color":"rgba(0, 0, 0, 0.8)"},attrs:{"disable-scroll":"true","canvas-id":e.cropperOpt.id},on:{touchstart:function(t){t=e.$handleEvent(t),e.touchStart(t)},touchmove:function(t){t=e.$handleEvent(t),e.touchMove(t)},touchend:function(t){t=e.$handleEvent(t),e.touchEnd(t)}}}),o("v-uni-cover-view",{staticClass:"cropper-buttons-tip"},[e._v("图片只支持jpg,png,jpeg")]),o("v-uni-cover-view",{staticClass:"cropper-buttons"},[o("v-uni-cover-view",{staticClass:"upload",on:{click:function(t){t=e.$handleEvent(t),e.uploadTap(t)}}},[e._v("选择图片")]),o("v-uni-cover-view",{staticClass:"getCropperImage",on:{click:function(t){t=e.$handleEvent(t),e.saveCropperImage(t)}}},[e._v("完成")])],1)],1)],1)},r=[];o.d(t,"a",function(){return n}),o.d(t,"b",function(){return r})},bfd7:function(e,t,o){"use strict";o.r(t);var n=o("ce12"),r=o.n(n);for(var i in n)"default"!==i&&function(e){o.d(t,e,function(){return n[e]})}(i);t["default"]=r.a},ce12:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(o("eb06")),r=a(o("8212")),i=a(o("e143"));function a(e){return e&&e.__esModule?e:{default:e}}function c(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var u=wx.getSystemInfoSync(),s=u.windowWidth,d=u.windowHeight-50,l=(getApp(),i.default.extend({data:function(){return{type:"",originSrc:"",isChange:!1,cropperOpt:{id:"cropper",rotateI:0,tranlateX:s/2,tranlateY:d/2,width:s,height:d,scale:2.5,zoom:8,cut:{x:(s-s/1.6)/2,y:(d-.8*s)/2,width:s/1.6,height:s/1.6}},sizex:750,sizey:420}},methods:{getCropperImage:function(){this.wecropper.getCropperImage(function(e){e?wx.previewImage({current:"",urls:[e]}):console.log("获取图片地址失败，请稍后重试")})},uploadTap:function(){var e=this;wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(t){e.isChange=!0;var o=t.tempFilePaths[0],n=t.tempFiles[0].size,i=o.substr(o.lastIndexOf(".")+1,o.length);if(n>5e7)return r.default.showFail("上传图片大小不能大于50M！");"jpg"!==i&&"jpeg"!==i&&"png"!==i?r.default.showFail("上传图片格式为jpg、png、jpeg"):(e.wecropper.pushOrign(o),e.originSrc=o)}})},saveCropperImage:function(){var e=this.type,t=this.originSrc;this.wecropper.getCropperImage(function(o){var n;o&&e.length?(r.default.getPage(-1).setData((n={},c(n,e,o),c(n,"originSrc",t),c(n,"originEditSrc",o),n)),wx.navigateBack()):console.log("生成图片地址失败，请稍后重试")})},touchStart:function(e){this.wecropper.touchStart(e)},touchMove:function(e){this.wecropper.touchMove(e)},touchEnd:function(e){this.wecropper.touchEnd(e)}},onLoad:function(e){var t=this.cropperOpt,o=e.ratio,r=e.src,i=e.type;e.width&&e.height&&e.sizex&&e.sizey&&(t.cut.width=1*e.width,t.cut.height=1*e.height,t.cut.x=(s-1*e.width)/2,t.cut.y=(d-1*e.height)/2,this.cropperOpt=t,this.sizex=e.sizex,this.sizey=e.sizey),this.type=i;if(o){var a=this.cropperOpt,c=(a.width,a.height),u=this.cropperOpt.cut.width,l=u*o,h=(c-l)/2;this.cropperOpt.cut.y=h,this.cropperOpt.cut.height=l}this.wecropper=new n.default(t).on("ready",function(e){r&&e.pushOrign(r)}).on("beforeImageLoad",function(e){wx.showToast({title:"上传中",icon:"loading",duration:2e4})}).on("imageLoad",function(e){wx.hideToast()}).on("beforeDraw",function(e,t){}).updateCanvas()}}));t.default=l},eb06:function(e,t,o){"use strict";(function(n){var r,i;function a(e){return a="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}
/**
 * we-cropper v1.2.0
 * (c) 2018 dlhandsome
 * @license MIT
 */
/**
 * we-cropper v1.2.0
 * (c) 2018 dlhandsome
 * @license MIT
 */
(function(n,c){"object"===a(t)&&"undefined"!==typeof e?e.exports=c():(r=c,i="function"===typeof r?r.call(t,o,t,e):r,void 0===i||(e.exports=i))})(0,function(){var e=void 0,t=["touchstarted","touchmoved","touchended"];function o(e){return"function"===typeof e}function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}function i(e){var o=[],n=arguments.length-1;while(n-- >0)o[n]=arguments[n+1];t.forEach(function(t,n){void 0!==o[n]&&(e[t]=o[n])})}function c(e,t){Object.defineProperties(e,t)}function u(){return e||(e=wx.getSystemInfoSync()),e}var s={},d={id:{default:"cropper",get:function(){return s.id},set:function(e){"string"!==typeof e&&console.error("id："+e+" is invalid"),s.id=e}},width:{default:750,get:function(){return s.width},set:function(e){"number"!==typeof e&&console.error("width："+e+" is invalid"),s.width=e}},height:{default:750,get:function(){return s.height},set:function(e){"number"!==typeof e&&console.error("height："+e+" is invalid"),s.height=e}},scale:{default:2.5,get:function(){return s.scale},set:function(e){"number"!==typeof e&&console.error("scale："+e+" is invalid"),s.scale=e}},zoom:{default:5,get:function(){return s.zoom},set:function(e){"number"!==typeof e?console.error("zoom："+e+" is invalid"):(e<0||e>10)&&console.error("zoom should be ranged in 0 ~ 10"),s.zoom=e}},src:{default:"cropper",get:function(){return s.src},set:function(e){"string"!==typeof e&&console.error("id："+e+" is invalid"),s.src=e}},cut:{default:{},get:function(){return s.cut},set:function(e){"object"!==a(e)&&console.error("id："+e+" is invalid"),s.cut=e}},onReady:{default:null,get:function(){return s.ready},set:function(e){s.ready=e}},onBeforeImageLoad:{default:null,get:function(){return s.beforeImageLoad},set:function(e){s.beforeImageLoad=e}},onImageLoad:{default:null,get:function(){return s.imageLoad},set:function(e){s.imageLoad=e}},onBeforeDraw:{default:null,get:function(){return s.beforeDraw},set:function(e){s.beforeDraw=e}}};function l(){var e=this,t=u(),o=t.windowWidth;e.attachPage=function(){var t=getCurrentPages(),o=t[t.length-1];o.wecropper=e},e.createCtx=function(){var t=e.id;t?e.ctx=wx.createCanvasContext(t):console.error("constructor: create canvas context failed, 'id' must be valuable")},e.deviceRadio=o/750}function h(){var e=this,t=["ready","beforeImageLoad","beforeDraw","imageLoad"];e.on=function(o,n){return t.indexOf(o)>-1?"function"===typeof n&&("ready"===o?n(e):e["on"+r(o)]=n):console.error("event: "+o+" is invalid"),e}}var f="undefined"!==typeof window?window:"undefined"!==typeof n?n:"undefined"!==typeof self?self:{};function p(e,t){return t={exports:{}},e(t,t.exports),t.exports}var g=p(function(e,t){
/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */
(function(o){var n=t,r=e&&e.exports==n&&e,i="object"==a(f)&&f;i.global!==i&&i.window!==i||(o=i);var c=function(e){this.message=e};c.prototype=new Error,c.prototype.name="InvalidCharacterError";var u=function(e){throw new c(e)},s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=/[\t\n\f\r ]/g,l=function(e){e=String(e).replace(d,"");var t=e.length;t%4==0&&(e=e.replace(/==?$/,""),t=e.length),(t%4==1||/[^+a-zA-Z0-9\/]/.test(e))&&u("Invalid character: the string to be decoded is not correctly encoded.");var o,n,r=0,i="",a=-1;while(++a<t)n=s.indexOf(e.charAt(a)),o=r%4?64*o+n:n,r++%4&&(i+=String.fromCharCode(255&o>>(-2*r&6)));return i},h=function(e){e=String(e),/[^\0-\xFF]/.test(e)&&u("The string to be encoded contains characters outside of the Latin1 range.");var t,o,n,r,i=e.length%3,a="",c=-1,d=e.length-i;while(++c<d)t=e.charCodeAt(c)<<16,o=e.charCodeAt(++c)<<8,n=e.charCodeAt(++c),r=t+o+n,a+=s.charAt(r>>18&63)+s.charAt(r>>12&63)+s.charAt(r>>6&63)+s.charAt(63&r);return 2==i?(t=e.charCodeAt(c)<<8,o=e.charCodeAt(++c),r=t+o,a+=s.charAt(r>>10)+s.charAt(r>>4&63)+s.charAt(r<<2&63)+"="):1==i&&(r=e.charCodeAt(c),a+=s.charAt(r>>2)+s.charAt(r<<4&63)+"=="),a},p={encode:h,decode:l,version:"0.1.0"};if(n&&!n.nodeType)if(r)r.exports=p;else for(var g in p)p.hasOwnProperty(g)&&(n[g]=p[g]);else o.base64=p})(f)});function v(e,t){return"data:"+t+";base64,"+e}function b(e){e=e.toLowerCase().replace(/jpg/i,"jpeg");var t=e.match(/png|jpeg|bmp|gif/)[0];return"image/"+t}function w(e){var t="";if("string"===typeof e)t=e;else for(var o=0;o<e.length;o++)t+=String.fromCharCode(e[o]);return g.encode(t)}function x(e,t,o,n,r,i){wx.canvasGetImageData({canvasId:e,x:t,y:o,width:n,height:r,success:function(e){i(e)},fail:function(e){i(null),console.error("canvasGetImageData error: "+e)}})}function y(e){var t=e.width,o=e.height,n=t*o*3,r=n+54,i=[66,77,255&r,r>>8&255,r>>16&255,r>>24&255,0,0,0,0,54,0,0,0],a=[40,0,0,0,255&t,t>>8&255,t>>16&255,t>>24&255,255&o,o>>8&255,o>>16&255,o>>24&255,1,0,24,0,0,0,0,0,255&n,n>>8&255,n>>16&255,n>>24&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c=(4-3*t%4)%4,u=e.data,s="",d=t<<2,l=o,h=String.fromCharCode;do{for(var f=d*(l-1),p="",g=0;g<t;g++){var v=g<<2;p+=h(u[f+v+2])+h(u[f+v+1])+h(u[f+v])}for(var b=0;b<c;b++)p+=String.fromCharCode(0);s+=p}while(--l);var x=w(i.concat(a))+w(s);return x}function m(e,t,n,r,i,a,c){void 0===c&&(c=function(){}),void 0===a&&(a="png"),a=b(a),/bmp/.test(a)?x(e,t,n,r,i,function(e){var t=y(e);o(c)&&c(v(t,"image/"+a))}):console.error("暂不支持生成'"+a+"'类型的base64图片")}var k={convertToImage:m,convertToBMP:function(e,t){void 0===e&&(e={});var o=e.canvasId,n=e.x,r=e.y,i=e.width,a=e.height;return void 0===t&&(t=function(){}),m(o,n,r,i,a,"bmp",t)}};function S(){var e=this,t=e.id,n=e.deviceRadio,r=e.width,i=e.height,a=e.cut,c=a.x;void 0===c&&(c=0);var u=a.y;void 0===u&&(u=0);var s=a.width;void 0===s&&(s=r);var d=a.height;void 0===d&&(d=i),e.updateCanvas=function(){return e.croperTarget&&e.ctx.drawImage(e.croperTarget,e.imgLeft,e.imgTop,e.scaleWidth,e.scaleHeight),o(e.onBeforeDraw)&&e.onBeforeDraw(e.ctx,e),e.setBoundStyle(),e.ctx.draw(),e},e.pushOrign=function(t){return e.src=t,o(e.onBeforeImageLoad)&&e.onBeforeImageLoad(e.ctx,e),wx.getImageInfo({src:t,success:function(t){var n=t.width/t.height;e.croperTarget=t.path,n<s/d?(e.rectX=c,e.baseWidth=s,e.baseHeight=s/n,e.rectY=u-Math.abs((d-e.baseHeight)/2)):(e.rectY=u,e.baseWidth=d*n,e.baseHeight=d,e.rectX=c-Math.abs((s-e.baseWidth)/2)),e.imgLeft=e.rectX,e.imgTop=e.rectY,e.scaleWidth=e.baseWidth,e.scaleHeight=e.baseHeight,e.updateCanvas(),o(e.onImageLoad)&&e.onImageLoad(e.ctx,e)}}),e.update(),e},e.getCropperBase64=function(e){void 0===e&&(e=function(){}),k.convertToBMP({canvasId:t,x:c,y:u,width:s,height:d},e)},e.getCropperImage=function(){var r=[],i=arguments.length;while(i--)r[i]=arguments[i];var a=toString.call(r[0]),l=r[r.length-1];switch(a){case"[object Object]":var h=r[0],f=h.quality;void 0===f&&(f=10),"number"!==typeof f?console.error("quality："+f+" is invalid"):(f<0||f>10)&&console.error("quality should be ranged in 0 ~ 10"),wx.canvasToTempFilePath({canvasId:t,x:c,y:u,width:s,height:d,destWidth:s*f/(10*n),destHeight:d*f/(10*n),success:function(t){o(l)&&l.call(e,t.tempFilePath)},fail:function(t){o(l)&&l.call(e,null)}});break;case"[object Function]":wx.canvasToTempFilePath({canvasId:t,x:c,y:u,width:s,height:d,destWidth:s/n,destHeight:d/n,success:function(t){o(l)&&l.call(e,t.tempFilePath)},fail:function(t){o(l)&&l.call(e,null)}});break}return e}}var C=function(e,t,o,n,r){var i,a,c;return i=Math.round(r.x-n.x),a=Math.round(r.y-n.y),c=Math.round(Math.sqrt(i*i+a*a)),e+.001*o*(c-t)};function I(){var e=this;e.src&&(e.__oneTouchStart=function(t){e.touchX0=Math.round(t.x),e.touchY0=Math.round(t.y)},e.__oneTouchMove=function(t){var o,n;if(e.touchended)return e.updateCanvas();o=Math.round(t.x-e.touchX0),n=Math.round(t.y-e.touchY0);var r=Math.round(e.rectX+o),i=Math.round(e.rectY+n);e.outsideBound(r,i),e.updateCanvas()},e.__twoTouchStart=function(t,o){var n,r,i;e.touchX1=Math.round(e.rectX+e.scaleWidth/2),e.touchY1=Math.round(e.rectY+e.scaleHeight/2),n=Math.round(o.x-t.x),r=Math.round(o.y-t.y),i=Math.round(Math.sqrt(n*n+r*r)),e.oldDistance=i},e.__twoTouchMove=function(t,o){var n=e.oldScale,r=e.oldDistance,i=e.scale,a=e.zoom;e.newScale=C(n,r,a,t,o),e.newScale<=1&&(e.newScale=1),e.newScale>=i&&(e.newScale=i),e.scaleWidth=Math.round(e.newScale*e.baseWidth),e.scaleHeight=Math.round(e.newScale*e.baseHeight);var c=Math.round(e.touchX1-e.scaleWidth/2),u=Math.round(e.touchY1-e.scaleHeight/2);e.outsideBound(c,u),e.updateCanvas()},e.__xtouchEnd=function(){e.oldScale=e.newScale,e.rectX=e.imgLeft,e.rectY=e.imgTop})}var M={touchStart:function(e){var t=this,o=e.touches,n=o[0],r=o[1];i(t,!0,null,null),t.__oneTouchStart(n),e.touches.length>=2&&t.__twoTouchStart(n,r)},touchMove:function(e){var t=this,o=e.touches,n=o[0],r=o[1];i(t,null,!0),1===e.touches.length&&t.__oneTouchMove(n),e.touches.length>=2&&t.__twoTouchMove(n,r)},touchEnd:function(e){var t=this;i(t,!1,!1,!0),t.__xtouchEnd()}};function T(){var e=this,t=e.width,o=e.height,n=e.cut,r=n.x;void 0===r&&(r=0);var i=n.y;void 0===i&&(i=0);var a=n.width;void 0===a&&(a=t);var c=n.height;void 0===c&&(c=o),e.outsideBound=function(t,o){e.imgLeft=t>=r?r:e.scaleWidth+t-r<=a?r+a-e.scaleWidth:t,e.imgTop=o>=i?i:e.scaleHeight+o-i<=c?i+c-e.scaleHeight:o},e.setBoundStyle=function(n){void 0===n&&(n={});var u=n.color;void 0===u&&(u="#04b00f");var s=n.mask;void 0===s&&(s="rgba(0, 0, 0, 0.3)");var d=n.lineWidth;void 0===d&&(d=1);var l=[{start:{x:r-d,y:i+10-d},step1:{x:r-d,y:i-d},step2:{x:r+10-d,y:i-d}},{start:{x:r-d,y:i+c-10+d},step1:{x:r-d,y:i+c+d},step2:{x:r+10-d,y:i+c+d}},{start:{x:r+a-10+d,y:i-d},step1:{x:r+a+d,y:i-d},step2:{x:r+a+d,y:i+10-d}},{start:{x:r+a+d,y:i+c-10+d},step1:{x:r+a+d,y:i+c+d},step2:{x:r+a-10+d,y:i+c+d}}];e.ctx.beginPath(),e.ctx.setFillStyle(s),e.ctx.fillRect(0,0,r,o),e.ctx.fillRect(r,0,a,i),e.ctx.fillRect(r,i+c,a,o-i-c),e.ctx.fillRect(r+a,0,t-r-a,o),e.ctx.fill(),l.forEach(function(t){e.ctx.beginPath(),e.ctx.setStrokeStyle(u),e.ctx.setLineWidth(d),e.ctx.moveTo(t.start.x,t.start.y),e.ctx.lineTo(t.step1.x,t.step1.y),e.ctx.lineTo(t.step2.x,t.step2.y),e.ctx.stroke()})}}var j="1.2.0",_=function(e){var t=this,o={};return c(t,d),Object.keys(d).forEach(function(e){o[e]=d[e].default}),Object.assign(t,o,e),t.prepare(),t.attachPage(),t.createCtx(),t.observer(),t.cutt(),t.methods(),t.init(),t.update(),t};return _.prototype.init=function(){var e=this,t=e.src;return e.version=j,"function"===typeof e.onReady&&e.onReady(e.ctx,e),t&&e.pushOrign(t),i(e,!1,!1,!1),e.oldScale=1,e.newScale=1,e},Object.assign(_.prototype,M),_.prototype.prepare=l,_.prototype.observer=h,_.prototype.methods=S,_.prototype.cutt=T,_.prototype.update=I,_})}).call(this,o("c8ba"))}}]);