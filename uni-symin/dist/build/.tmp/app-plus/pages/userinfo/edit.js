(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/userinfo/edit"],{2901:function(e,t,s){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=h(s("66fd")),o=h(s("db49")),n=h(s("8212")),r=h(s("82f8")),a=h(s("6d8e"));function h(e){return e&&e.__esModule?e:{default:e}}var c=getApp(),l=i.default.extend({data:function(){return{title:"Hello",STATUS_BAR_HEIGHT:wx.STATUS_BAR_HEIGHT,DEFAULT_HEADER_HEIGHT:wx.DEFAULT_HEADER_HEIGHT,barconfig:{CustomBar:wx.STATUS_BAR_HEIGHT+wx.DEFAULT_HEADER_HEIGHT,StatusBar:wx.STATUS_BAR_HEIGHT,title:"编辑资料",bgset:"bg-gradual-dred",tset:"bg-gradual-tred",hiddenTitle:2,isArrow:2},prossWidth:0,editDetail:[{key:"0",title:"昵称",icon:"",content:"",arrow:!1,size:40,type:"text",url:"",isBorderR:!1,placeholder:"点击输入",isInput:!0,selfconf:!1},{key:"1",title:"性别",icon:"",content:"",arrow:!1,size:40,type:"button",url:"",isBorderR:!1,placeholder:"点击选择",isInput:!1,selfconf:!1},{key:"2",title:"出生年月",icon:"",content:"",arrow:!0,size:40,type:"button",url:"",isBorderR:!1,placeholder:"点击选择",isInput:!1,selfconf:!1},{key:"3",title:"身高",icon:"",content:"",arrow:!0,size:40,type:"button",url:"",isBorderR:!1,placeholder:"点击选择",isInput:!1,selfconf:!1},{key:"4",title:"行业",icon:"",content:"",arrow:!0,size:40,type:"url",url:"/pages/tool/job",isBorderR:!1,placeholder:"点击选择",isInput:!1,selfconf:!1},{key:"5",title:"年收入",icon:"",content:"",arrow:!0,size:40,type:"button",url:"",isBorderR:!1,placeholder:"点击选择",isInput:!1,selfconf:!1},{key:"6",title:"邀约项目",icon:"",content:"",arrow:!0,size:40,type:"button",url:"",isBorderR:!1,placeholder:"点击选择",isInput:!1,selfconf:!1},{key:"7",title:"微信",icon:"",content:"",arrow:!1,size:40,type:"text",url:"",isBorderR:!1,placeholder:"点击输入",isInput:!0,selfconf:!1,last:!0}],popmaskStyle:{"background-color":"rgba(0,0,0,.5)"},uinfoinputStyle:{"border-bottom":0},items:[],boxconfig:{key:0,model:2,btn:{ok:"确定",okcolor:"d-color-r",cancel:"取消",cancolor:"d-color-b"}},choseKey:0,showkey:-1,showchose:!1,showchoseStatus:0,showChoosebox:!1,isShing:!0,editHead:"https://sns-cdn.myxianxiaobao.com/sfximao/test1.jpg",editsh:"../../static/images/edit-sh.png",editnopass:"../../static/images/edit-nopass.png",editadd:"../../static/images/edit-add.png",jobObj:{id:"",title:""},userInfo:{wx:"",nickname:"",gender:1,birthday:"",height:160},imgArrs:[{src:"https://sns-cdn.myxianxiaobao.com/sfximao/test1.jpg",pass:1,key:0,isbtn:!1},{src:"",pass:0,key:1,isbtn:!1},{src:"",pass:0,key:2,isbtn:!1},{src:"",pass:0,key:3,isbtn:!1},{src:"",pass:0,key:4,isbtn:!1},{src:"",pass:0,key:5,isbtn:!1}],selfTypes:[],selfPays:[],selfPaysIndex:0,selfTypesIndex:0,sexConfig:[],sex:1,selfHeight:150,timeChoose:[1991,1,15],initname:"",headChange:!1,originSrc:""}},onLoad:function(){this.sexConfig=Object.assign(o.default.sexConfig),this.initData()},onShow:function(){this.setJob(),this.caclWidth();var e=getCurrentPages(),t=e[e.length-1];t.data.originSrc&&(this.originSrc=t.data.originSrc,this.uploadFile(this.originSrc,0))},methods:{initData:function(){var e=this;this.userInfo=c.globalData.userInfo,this.selfTypes=c.globalData.selfTypes,this.selfPays=c.globalData.selfPays,this.jobObj={id:this.userInfo.occupation,title:this.userInfo.occupation_str||"全部职业"};var t=this.userInfo.verfiy_list&&this.userInfo.verfiy_list.filter(function(e){return"nickname"===e.type}),s=this.userInfo.verfiy_list&&this.userInfo.verfiy_list.filter(function(e){return"wechat"===e.type});this.initname=this.userInfo.nickname,this.editDetail[0].content=t.length&&t[0].value||this.userInfo.nickname,this.editDetail[1].content=1===this.userInfo.gender?"男":"女",this.editDetail[2].content=this.userInfo.birthday,this.editDetail[3].content=this.userInfo.height+"cm"||!1,this.editDetail[4].content=this.userInfo.occupation_str||"全部职业",this.editDetail[5].content=this.selfPays.filter(function(t,s){return t.value===1*e.userInfo.revenue&&(e.selfPaysIndex=s),t.value===1*e.userInfo.revenue})[0].text,this.editDetail[6].content=this.selfTypes.filter(function(t,s){return t.value===1*e.userInfo.objective&&(e.selfTypesIndex=s),t.value===1*e.userInfo.objective})[0].text,this.editDetail[7].content=s.length&&"undefined"!=s[0].value&&s[0].value,t.length&&0===t[0].pass&&t[0].value&&"undefined"!=t[0].value?this.editDetail[0].titleicon="审核中":this.editDetail[0].titleicon="",s.length&&s[0].value&&"undefined"!=s[0].value&&(this.editDetail[7].titleicon="",0===s[0].pass&&(this.editDetail[7].titleicon="审核中"),2===s[0].pass&&(this.editDetail[7].content="")),this.editDetail[7].isInput=!s.length||1!==s[0].pass,this.userInfo.birthday.length&&(this.timeChoose=this.userInfo.birthday.split("-")),this.userInfo.timeChoose=this.timeChoose,this.setImgArr()},setImgArr:function(){var e=this,t=this.userInfo&&this.userInfo.verfiy_list&&this.userInfo.verfiy_list.filter(function(e){return"header"===e.type&&2!==e.pass})[0];this.imgArrs[0]=t?{src:t.value||"",pass:t.pass||0,key:0,isbtn:!1}:{src:this.userInfo.header_url,pass:1,key:0,isbtn:!1};var s=this.userInfo&&this.userInfo.verfiy_list&&this.userInfo.verfiy_list.filter(function(e){return"picture"===e.type});s.map(function(t){t.src=t.value||"",t.key=t.location,t.isbtn=!1,e.imgArrs[t.key]=Object.assign(t)})},setJob:function(){var e=getCurrentPages(),t=e[e.length-1],s=t.data.jobObj.id&&t.data.jobObj||this.jobObj;this.editDetail[4].content=s.title||"",this.editDetail[4].url="/pages/tool/job?id="+s.id,this.jobObj=s,this.userInfo.occupation=s.id||0,this.userInfo.occupation_str=s.title},getUserInfo:function(){var e=this;c.$vm.getUserInfo().then(function(t){e.userInfo=t,e.init()}).catch(function(e){console.log("用户信息获取失败！"," at pages\\userinfo\\edit.vue:355")})},caclWidth:function(){var e=0,t=this.imgArrs.filter(function(e){return e.src.length}).length,s=this.editDetail.filter(function(e){return e.content&&e.content.length}).length;this.prossWidth=e+5*s+10*t},showImgBtn:function(e,t){this.showkey=e,this.showchoseStatus=t,e&&2===t?this.chooseFile(e):this.showchose=!0},checkPic:function(){this.checkBtn(this.showkey),this.showchose=!1},checkBtn:function(e){var t=this.imgArrs[1*e].src;wx.previewImage({current:t,urls:[t]})},deleteBtn:function(t){var s=this,i={location:1*t};r.default.deletePhoto(i).then(function(i){1e4===i.code?(s.imgArrs[1*t].src&&s.caclWidth(),s.imgArrs[1*t].src="",s.imgArrs[1*t].isbtn=!1,s.$set(s.imgArrs,1*t,s.imgArrs[1*t]),e.$emit("getUserInfo")):n.default.showFail("删除图片失败!")})},chooseFile:function(e){var t=this;wx.chooseImage({count:1,sourceType:["album","camera"],success:function(s){var i=s.tempFilePaths[0];t.uploadFile(i,e)}})},uploadFile:function(e,t){var s=this;n.default.showLoading("图片上传中...."),r.default.upload({filePath:e}).then(function(i){n.default.hideAll(),s.imgArrs[t].src=e,t?s.uploadPhoto(i.src,t):(s.originSrc="",s.userInfo.header_url=i.src,s.saveUser(s.userInfo.header_url),s.headChange=!0,s.imgArrs[t].pass=0),s.caclWidth()})},uploadPhoto:function(e,t){var s=this,i={value:e,location:t};r.default.uploadPhoto(i).then(function(e){1e4===e.code?(n.default.showSuccess("上传图片成功!"),s.imgArrs[t].pass=0):(n.default.showFail("上传图片失败!"),s.imgArrs[t].src="",s.caclWidth())})},saveMession:function(){this.userInfo.wechat_number&&"undefined"!==this.userInfo.wechat_number?(this.boxconfig.key=7,this.boxconfig.model=1,this.boxconfig.content="一旦确定好了微信，后面将无法更改 确定吗？",this.showChoosebox=!0):this.saveInfo()},saveUser:function(t){var s={id:this.userInfo.memberID,header_url:t};a.default.saveData(s).then(function(t){1e4===t.code&&e.$emit("getUserInfo",{msg:"更新用户信息"})})},saveInfo:function(){this.showChoosebox&&(this.showChoosebox=!1,this.boxconfig.content="",this.boxconfig.model=2,this.boxconfig.key=0);var e=this,t=(this.userInfo&&this.userInfo.verfiy_list&&this.userInfo.verfiy_list.filter(function(e){return"header"===e.type})[0],{birthday:e.userInfo.timeChoose&&e.userInfo.timeChoose.join("-"),gender:e.userInfo.gender,height:e.userInfo.height,revenue:e.userInfo.revenue,objective:e.userInfo.objective,occupation:e.userInfo.occupation,wechat_number:e.userInfo.wechat_number,nickname:e.userInfo.nickname});(e.editDetail[0].titleicon&&e.editDetail[0].titleicon.length||this.initname===this.userInfo.nickname)&&delete t.nickname,(e.editDetail[7].titleicon&&e.editDetail[7].titleicon.length||!e.editDetail[7].isInput||!t.wechat_number)&&delete t.wechat_number,n.default.showLoading("数据保存中，请稍等.."),a.default.saveData(t).then(function(t){n.default.hideLoading(),1e4===t.code?(n.default.showSuccess("保存成功!",1e3),c.$vm.getUserInfo().then(function(t){e.initData()})):n.default.showFail("保存失败, 请重试!")})},chooseItem:function(e){var t=e.detail.val;switch(t){case"1":return;case"2":this.boxconfig.key=2,this.boxconfig.model=3,this.showChoosebox=!0;break;case"3":this.items=Object.assign(o.default.selfHeight),this.boxconfig.key=3,this.boxconfig.model=2,this.choseKey=this.userInfo.height-150,this.showChoosebox=!0;break;case"4":n.default.goUrl(e);break;case"5":this.items=Object.assign(this.selfPays),this.boxconfig.key=5,this.boxconfig.model=2,this.choseKey=this.selfPaysIndex,this.showChoosebox=!0;break;case"6":this.items=Object.assign(this.selfTypes),this.boxconfig.key=6,this.boxconfig.model=2,this.choseKey=this.selfTypesIndex,this.showChoosebox=!0;break;default:break}},surefunc:function(e){var t=e.detail,s=t.key,i=t.choseIndex,o=t.time,n=t.val;if(!s&&e.detail)return this.saveInfo();switch(1*s){case 1:this.userInfo.gender=n,this.editDetail[1].content=1===this.userInfo.gender?"男":"女",this.showChoosebox=!1;break;case 2:this.timeChoose=Object.assign(o),this.userInfo.timeChoose=this.timeChoose,this.editDetail[2].content=this.timeChoose.join("-"),this.showChoosebox=!1;break;case 3:this.userInfo.height=n,this.editDetail[3].content=this.userInfo.height+"cm",this.showChoosebox=!1;break;case 5:this.selfPaysIndex=1*i,this.userInfo.revenue=n,this.editDetail[5].content=this.items[this.selfPaysIndex].text,this.showChoosebox=!1;break;case 6:this.selfTypesIndex=1*i,this.userInfo.objective=n,this.editDetail[6].content=this.items[this.selfTypesIndex].text,this.showChoosebox=!1;break;default:break}this.caclWidth()},optPic:function(){this.showkey?-1!==this.showkey&&this.deleteBtn(this.showkey):(this.showchose=!1,this.originSrc="",e.navigateTo({url:"/pages/tool/cropper?type=header_url"})),this.showchose=!1},cancelfunc:function(){this.showChoosebox=!1},valChange:function(e){var t=e.detail,s=t.key,i=t.val;"0"===s&&(this.userInfo.nickname=i),"7"===s&&(this.userInfo.wechat_number=i),this.caclWidth()}}});t.default=l}).call(this,s("6e42")["default"])},"2f9d":function(e,t,s){"use strict";s.r(t);var i=s("2901"),o=s.n(i);for(var n in i)"default"!==n&&function(e){s.d(t,e,function(){return i[e]})}(n);t["default"]=o.a},"71bc":function(e,t,s){},"733d":function(e,t,s){"use strict";s.r(t);var i=s("db43"),o=s("2f9d");for(var n in o)"default"!==n&&function(e){s.d(t,e,function(){return o[e]})}(n);s("c0f3");var r=s("2877"),a=Object(r["a"])(o["default"],i["a"],i["b"],!1,null,null,null);t["default"]=a.exports},c0f3:function(e,t,s){"use strict";var i=s("71bc"),o=s.n(i);o.a},db43:function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement;e._self._c;e._isMounted||(e.e0=function(t){e.showchose=!1},e.e1=function(t){e.showchose=!1})},o=[];s.d(t,"a",function(){return i}),s.d(t,"b",function(){return o})}},[["d2db","common/runtime","common/vendor"]]]);