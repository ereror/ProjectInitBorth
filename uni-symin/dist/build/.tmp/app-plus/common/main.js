(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["common/main"],{"034f":function(e,t,i){"use strict";var n=i("9938"),a=i.n(n);a.a},"053b":function(e,t,i){"use strict";i.r(t);var n=i("0c71"),a=i.n(n);for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);t["default"]=a.a},"0c71":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(i("4360"));function a(e){return e&&e.__esModule?e:{default:e}}var o=n.default;t.default=o},"3dfd":function(e,t,i){"use strict";i.r(t);var n,a,o=i("3e72"),s=o["a"],l=(i("034f"),i("2877")),c=Object(l["a"])(s,n,a,!1,null,null,null);t["default"]=c.exports},"3e72":function(e,t,i){"use strict";(function(e){var n=i("66fd"),a=i("82f8"),o=i.n(a),s=i("6d8e"),l=i.n(s),c=i("8212"),d=i.n(c),r=i("88d3"),g=i.n(r),f=i("72eb"),u=i.n(f);wx.instantmessaging={thishe:"testclothes",testclothes:{service:{token:"0063951a9f7198f2f56f0953cf2fed29",accid:"service"},notice:{token:"d6a3732df8b10f92a2acdbc64fbf121e",accid:"notice"},appkey:"f1f40794fc391d650373015a6d8f5683",appsecret:"503c2403f0f9"},formaldress:{service:{token:"0063951a9f7198f2f56f0953cf2fed29",accid:"service"},notice:{token:"d6a3732df8b10f92a2acdbc64fbf121e",accid:"notice"},appkey:"f1f40794fc391d650373015a6d8f5683",appsecret:"503c2403f0f9"}};t["a"]=n["default"].extend({mpType:"app",globalData:{vipIcon:["../../static/images/vip-icon-by.png","../../static/images/vip-icon-bj.png","../../static/images/vip-icon-hj.png","../../static/images/vip-icon-zs.png"],code:"",openid:"",token:"",sex:"",searchIndexResult:!1,Iitemimg:"https://mzw-sns.oss-cn-beijing.aliyuncs.com/images/default/def_avatar_boy.png",Iitemimgw:"https://mzw-sns.oss-cn-beijing.aliyuncs.com/images/default/def_avatar_girl.png",vipItem:[],isUpdateHeadUrl:"",isBrush:!1,bannerList:[],locationInfo:{latitude:"",longitude:""},isNotRegist:!0,otherId:"",yYtype:{"吃饭":"https://mzw-sns.oss-cn-beijing.aliyuncs.com/sfximao/yt-dinner.png","运动":"https://mzw-sns.oss-cn-beijing.aliyuncs.com/sfximao/yt-activity.png","喝一杯":"https://mzw-sns.oss-cn-beijing.aliyuncs.com/sfximao/yt-drank.png","恋爱":"https://mzw-sns.oss-cn-beijing.aliyuncs.com/sfximao/yt-friend.png","玩游戏":"https://mzw-sns.oss-cn-beijing.aliyuncs.com/sfximao/yt-game.png","看电影":"https://mzw-sns.oss-cn-beijing.aliyuncs.com/sfximao/yt-movie.png","唱歌":"https://mzw-sns.oss-cn-beijing.aliyuncs.com/sfximao/yt-song.png","旅游":"https://mzw-sns.oss-cn-beijing.aliyuncs.com/sfximao/yt-trave.png"}},data:{isloading:!1,isNotRegist:!0},onLaunch(t){let i=this.$options,n=(t.path,t.query.otherId);i.globalData.otherId=n||"",e.$on("registR",()=>{this.isNotRegist=!1,i.globalData.isNotRegist=!1}),d.a.attachInfo(!0);let a=g.a.getItem("token");a&&(i.globalData.token=a,this.init()),d.a.getCode().then(t=>{return t?(i.globalData.code=t,new Promise((e,i)=>{e(t),console.log(t)})):(e.showToast({title:"用户登录失败，请重新获取登录！",icon:"none"}),new Promise((e,t)=>{t(0)}))}).then(t=>{o.a.uerLogin({code:t}).then(t=>{let n=t.data;if(1e4===t.code){i.globalData.token=n.token,i.globalData.uid=n.uid;let e=n.status;g.a.setItem("token",i.globalData.token),this.isNotRegist=!1,i.globalData.isNotRegist=!1,a||this.init(),this.goDesnation(e)}else 99999===t.code&&(i.globalData.openid=n.openid,g.a.setItem("openid",i.globalData.openid),g.a.removeItem("token"),i.globalData.isNotRegist=!0,this.isNotRegist=!0,e.$emit("update",{msg:"页面注册"}))}).catch(t=>{e.showToast({title:"消息存在错误",icon:"none"})})})},onShow(t){let i=this.$options;i.globalData.isNotRegist&&"pages/index/begin"===t.path&&e.$emit("update",{msg:"页面注册"})},onHide(){},methods:{init(){this.updateApp(),this.getModel("selfPays","getRevenueList"),this.getModel("selfTypes","getTypeList"),e.$on("getUserInfo",e=>{this.getUserInfo()}),this.sendLocation()},updateApp(){const e=wx.getUpdateManager();e.onCheckForUpdate(function(e){console.log("Res:",e)}),e.onUpdateReady(function(){wx.showModal({title:"更新提示",content:"新版本已经准备好，是否重启应用？",success(t){t.confirm&&e.applyUpdate()}})})},getPlayList(){let e=this.$options;return new Promise((t,i)=>{l.a.vipList().then(n=>{if(1e4===n.code){let i=n.data&&n.data.length&&n.data;i.map((e,t)=>{e.text=`每天送${e.key_num}钥匙`,2===e.id&&(e.isTj=!0),4!==e.id&&"砖石vip"!==e.title.toLowerCase()&&998!==e.price||(e.lititle="Ta们会主动认识你"),0===e.price&&this.vipItem.splice(t,1)}),e.globalData.vipItem=i,t(n.data)}else i(0)})})},goDesnation(t){let i="/pages/index/index",n="/pages/message/join?from=index";this.getUserInfo(!0).then(a=>{let{height:o,birthday:s,objective:l,occupation:c,revenue:d,gender:r}=a;i=o&&s?l&&d?1===r&&0===t?n:"/pages/index/index":"/pages/regist/stepinfo":"/pages/regist/stepuser",e.reLaunch({url:i})}).catch(t=>{e.reLaunch({url:i})})},getUserInfo(e){let t=this.$options;return this.isloading&&!e?new Promise:(this.isloading=!0,new Promise((e,i)=>{l.a.getUserInfo({member_id:0}).then(n=>{if(this.isloading=!1,1e4===n.code){let i=Object.assign(n.data);i&&i.yxTk&&i.yxID?(console.log("当前用户已经登陆可以尝试登陆云信"),wx.NIMFUN=u.a.socket(this,i.yxTk,i.yxID)):(console.log("当前用户未登陆云信"),wx.NIMFUN=null),t.globalData.userInfo=i,e(i)}else i(0)}).catch(e=>{this.isloading=!1,i(0)})}))},saveData(e){let t=this.$options,i=e&&e.verfiy_list&&e.verfiy_list.filter(e=>"header"===e.type),n=e.verfiy_list&&e.verfiy_list.filter(e=>"wechat"===e.type),a=e.verfiy_list&&e.verfiy_list.filter(e=>"nickname"===e.type);return new Promise((o,s)=>{let c={birthday:e.timeChoose&&e.timeChoose.join("-")||e.birthday||"",height:e.height,revenue:e.revenue,objective:e.objective,occupation:e.occupation,header_url:e.header_url,wechat_number:e.wechat_number,nickname:e.nickname};i.length&&0===i[0].pass&&delete c.header_url,(n.length&&0===n[0].pass||!e.wechat_number)&&delete c.wechat_number,a.length&&0===a[0].pass&&delete c.nickname,c.header_url.length&&(t.globalData.isUpdateHeadUrl=!0),d.a.showLoading("数据保存中，请稍等.."),l.a.saveData(c).then(e=>{d.a.hideLoading(),1e4===e.code?(d.a.showSuccess("保存成功!"),o(1)):(d.a.showFail("保存失败, "+e.msg+"请重试!"),s(0))})})},sendLocation(){let e,t=this,i=this.$options,n=function(t,i){t&&t(),clearInterval(e),e=setInterval(()=>{t&&t()},i)},a=function(){i.globalData.token&&t.getLocationInfo(!0).then(e=>{let t={latitude:e.latitude,longitude:e.longitude,opt_system:wx.IS_IOS?1:2,platform:1,app_name:"51yue"};l.a.heartbeat(t)})};n(a,36e5)},getLocationInfo(e=!1){let t=this.$options,i=t.globalData.locationInfo,n=this;return new Promise((a,o)=>{i&&!e?a(i):wx.getLocation({type:"gcj02",success:function(e){let{latitude:i,longitude:n}=e,o={latitude:i,longitude:n};t.globalData.locationInfo=o,a(o)},fail:function(e){let t="定位失败",i="需要定位信息才能获取周边动态，是否重新定位",a=!0;~e.errMsg.indexOf("fail auth deny")&&(t="位置信息未授权",i="需要用户授权:设置界面（「右上角」 - 「关于」 - 「右上角」 - 「设置」）打开位置授权！",a=!1),wx.showModal({title:t,content:i,showCancel:!0,success:function(e){e.confirm&&a&&n.getLocationInfo()},fail:function(e){},complete:function(e){}})},complete:function(e){}})})},getModel(e,t){let i=g.a.getItem(e),n=this.$options;if(i.length)try{n.globalData[e]=i&&JSON.parse(i)}catch(a){n.globalData[e]=[]}else l.a[t]().then(t=>{if(1e4===t.code){let i=t.data;i.map(e=>{e.value=1*e.id,e.title&&(e.text=e.title),e.content&&(e.text=e.content)}),n.globalData[e]=i,g.a.setItem(e,i)}})}}})}).call(this,i("6e42")["default"])},"6b2c":function(e,t,i){"use strict";i.r(t);var n=i("053b");for(var a in n)"default"!==a&&function(e){i.d(t,e,function(){return n[e]})}(a);var o,s,l=i("2877"),c=Object(l["a"])(n["default"],o,s,!1,null,null,null);t["default"]=c.exports},9938:function(e,t,i){}},[["56d7","common/runtime","common/vendor"]]]);