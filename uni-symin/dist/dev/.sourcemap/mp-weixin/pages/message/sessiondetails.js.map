{"version":3,"sources":["webpack:///./src/pages/message/sessiondetails.vue?acdd","webpack:///./src/pages/message/sessiondetails.vue?5453","webpack:///./src/pages/message/sessiondetails.vue?6dbd","webpack:///./src/pages/message/sessiondetails.vue?abc1","webpack:///./src/pages/message/sessiondetails.vue"],"names":["Vue","extend","data","barconfig","CustomBar","wx","STATUS_BAR_HEIGHT","DEFAULT_HEADER_HEIGHT","StatusBar","title","bgset","tset","hiddenTitle","youchat","chattype","account","avatar","uid","msg","blacklistbs","computed","nim","userInfo","chatList","thischatList","chatListaccount","chatListaccountsession","onUnload","$refs","sessiondetails","clearIntervalfun","onLoad","options","console","log","nick","RefreshtheDialogue","parseInt","infoService","getOtherUser","member_id","then","res","code","relationship","bh","yxuserdata","yx_id_list","JSON","stringify","userdata","i","len","other","length","yxID","header_url","nickname","methods","NIMFUN","getHistoryMsgs","scene","to","limit","asc","endTime","done","err","obj","uni","showToast","icon","duration","msgs","$store","dispatch","blacklistos","USER","blacklist","pullgRelation","e","pullgRelatioasdasn","detail","dons","sendmeg","_this","sendText","text","list","Array","isArray","push"],"mappings":"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","file":"pages/message/sessiondetails.js","sourcesContent":["import { render, staticRenderFns } from \"./sessiondetails.vue?vue&type=template&id=4d1c6b78&\"\nimport script from \"./sessiondetails.vue?vue&type=script&lang=js&\"\nexport * from \"./sessiondetails.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"D:\\\\project\\\\qc_study\\\\sy_project\\\\sy-mini\\\\node_modules\\\\vue-hot-reload-api\\\\dist\\\\index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!module.hot.data) {\n      api.createRecord('4d1c6b78', component.options)\n    } else {\n      api.reload('4d1c6b78', component.options)\n    }\n    module.hot.accept(\"./sessiondetails.vue?vue&type=template&id=4d1c6b78&\", function () {\n      api.rerender('4d1c6b78', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"src/pages/message/sessiondetails.vue\"\nexport default component.exports","export * from \"-!../../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./sessiondetails.vue?vue&type=template&id=4d1c6b78&\"","var render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var m0 = _vm.blacklistos()\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        m0: m0\n      }\n    }\n  )\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }","import mod from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./sessiondetails.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./sessiondetails.vue?vue&type=script&lang=js&\"","//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {\n    mapGetters\n} from 'vuex'\nimport Vue from 'vue';\nimport infoService from '@/api/info/info'\nexport default Vue.extend({\n    data() {\n        return {\n            barconfig: {\n                CustomBar: wx.STATUS_BAR_HEIGHT + wx.DEFAULT_HEADER_HEIGHT,\n                StatusBar: wx.STATUS_BAR_HEIGHT,\n                title: '比伯Jane',\n                bgset: 'bg-gradual-dred',\n                tset: 'bg-gradual-tred',\n                hiddenTitle: 1\n            },\n            youchat: {\n                chattype: 'p2p',\n                account: 'haoyou',\n                avatar: '/static//images/iconH.jpg',\n                uid: '-1',\n                msg: ''\n            },\n            blacklistbs: false, // 对方是否把当前用户加黑\n            /**\n             * bh: 0 他黑了我\n             * h: 1 我黑了他\n             * relation: 1 是否有关系\n             */\n        }\n    },\n    computed: {\n        ...mapGetters({\n            nim: 'nim',\n            userInfo: 'userInfo', //当前登陆用户信息\n            chatList: 'chatList', // 会话列表\n            thischatList: 'thischatList', //聊天记录\n            chatListaccount: 'chatListaccount', // 当前对话用户账号\n            chatListaccountsession: 'chatListaccountsession', //当前对话会话id\n        })\n    },\n    onUnload(){\n        this.$refs.sessiondetails.clearIntervalfun()\n    },\n    onLoad(options) {\n        console.log(options)\n        /**\n         * 初始化 聊天对象资料  账号 头像 聊天类型\n         */\n        this.barconfig.title = options.nick || '未知昵称'\n        this.youchat = {\n            chattype: options.chattype || 'p2p',\n            account: options.account || 'haoyou',\n            avatar: options.avatar || '',\n            uid: options.uid || '-1',\n            msg: options.msg || ''\n        }\n        // 获取当前会话的最后20条消息更新至状态机\n        let account = this.youchat.account\n        this.RefreshtheDialogue(account)\n        if (this.youchat.uid && parseInt(this.youchat.uid) >= 0) {\n            infoService.getOtherUser({\n                member_id: this.youchat.uid\n            }).then(res => {\n                if (res.code === 10000) {\n                    this.blacklistbs = res.data.relationship.bh != 0\n                }\n            })\n        }\n        if (this.youchat.account == 'notice' || this.youchat.account == 'service') {\n            if (this.youchat.account == 'notice') {\n                this.youchat.avatar = '/static/images/systemicon.png'\n                this.barconfig.title = '系统通知'\n            } else {\n                this.youchat.avatar = '/static/images/serveicon.png'\n                this.barconfig.title = '客服'\n            }\n            return\n        }\n        // 更新对面用户数据信息\n        infoService.yxuserdata({\n            yx_id_list: JSON.stringify([this.youchat.account])\n        }).then(res => {\n            if (res.code == 10000) {\n                console.log('用户详情')\n                let userdata = {}\n                for (let i = 0, len = res.data.other.length; i < len; i++) {\n                    userdata[res.data.other[i].yxID] = res.data.other[i]\n                }\n                this.youchat.avatar = userdata[this.youchat.account].header_url\n                this.barconfig.title = userdata[this.youchat.account].nickname\n            }\n        })\n    },\n    methods: {\n        RefreshtheDialogue(account) {\n            wx.NIMFUN.getHistoryMsgs({\n                scene: 'p2p',\n                to: account, // 账号\n                limit: 20, //每页条数\n                asc: true, // 时间到序排序\n                endTime: 0, // 当前页  时间\n                done: (err, obj) => {\n                    if (err) {\n                        uni.showToast({\n                            title: '请检查网络后重试',\n                            icon: 'none',\n                            duration: 3000\n                        })\n                        return\n                    }\n                    console.log('当前用户：', account, obj.msgs)\n                    this.thischatList[`p2p-${account}`] = obj.msgs\n                    console.log(this.thischatList[`p2p-${account}`])\n                    this.$store.dispatch('chatListaccountsession', `p2p-${account}`)\n                    this.$store.dispatch('thischatList', this.thischatList)\n                }\n            })\n        },\n        /**\n         * 判断对方用户是否被加黑\n         */\n        blacklistos() {\n            if (wx.USER.blacklist[this.youchat.account]) {\n                return true\n            }\n            return false\n        },\n        pullgRelation(e) {\n            infoService.pullgRelatioasdasn(e.detail.data).then(res => {\n                e.detail.dons(res.code)\n            })\n        },\n        sendmeg(data) {\n            // 发送消息\n            const _this = this\n            wx.NIMFUN.sendText({\n                scene: data.detail.scene, // 对单个用户发起聊天\n                to: data.detail.to,\n                text: data.detail.text,\n                done: (err, msg) => {\n                    let list = this.thischatList[this.chatListaccountsession]\n                    if (!list || !Array.isArray(list) || list.length <= 0) {\n                        list = []\n                    }\n                    list.push(msg)\n                    this.thischatList[this.chatListaccountsession] = list\n                    this.$store.dispatch('thischatList', this.thischatList)\n                    data.detail.dons((err, msg))\n                }\n            })\n        }\n    }\n});\n"],"sourceRoot":""}